# SMessage — Repository paketi

Bu dosya üç ana parçadan oluşur: **index.html** (frontend), **server.js** (WS sinyalleme sunucusu) ve **README.md** (deploy & kullanım). Aşağıda tüm içerikler yer alıyor — GitHub'a direk yapıştırıp yayınla.

---

## index.html

```html
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SMessage - Peer-to-Peer Sohbet (WebSocket Sinyalleme + Test Mode)</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <style>
    /* (stil bölümü aynen buraya gelecek — ayrıntı için canvas içindeki kodu kullan) */
  </style>
</head>
<body>
  <!-- (HTML body aynen canvas içindeki kod ile aynı) -->
  <!-- Önemli: CONFIG bölümünde SIGNALING_SERVER_URL değişkenini ayarlayın -->
  <script>
    // SIGNALING_SERVER_URL: Sunucunuza göre değiştirin.
    const SIGNALING_SERVER_URL = '';
    // (geriye kalan JS kodu canvas içindeki index.html ile birebir aynı)
  </script>
</body>
</html>
```

> Not: Canvas üzerinde hâlihazırda tam frontend kodu mevcut. GitHub'a koyacağın `index.html` dosyasını buradaki içerikle değiştir. `SIGNALING_SERVER_URL` boş bırakılırsa **kopyala-yapıştır** modalı ve Test Modu çalışmaya devam eder.

---

## server.js (Basit WebSocket Sinyalleme Sunucusu)

Aşağıdaki `server.js` dosyasını Node.js (v18+) ile çalıştırabilirsin. Bu sunucu **oda tabanlı** sinyalleme sağlar; gelen `offer/answer/candidate` paketlerini aynı odadaki diğer clientlara iletir.

```js
// server.js
const http = require('http');
const WebSocket = require('ws');

const server = http.createServer();
const wss = new WebSocket.Server({ server });

// odalar: roomId -> Set of ws
const rooms = new Map();

function send(ws, obj) {
  try { ws.send(JSON.stringify(obj)); } catch (e) { console.warn('send err', e); }
}

wss.on('connection', (ws) => {
  ws._room = null;

  ws.on('message', (msg) => {
    let data = null;
    try { data = JSON.parse(msg); } catch (e) { return; }

    if (data.cmd === 'join' && data.room) {
      const room = data.room;
      ws._room = room;
      if (!rooms.has(room)) rooms.set(room, new Set());
      rooms.get(room).add(ws);
      // bildirim: kaç client var
      const clients = rooms.get(room).size;
      // notify all in room about join count
      rooms.get(room).forEach(c => send(c, { cmd: 'joined', room, clients }));
      return;
    }

    // forward signalling messages to others in same room
    if (ws._room) {
      const set = rooms.get(ws._room);
      if (!set) return;
      set.forEach(client => {
        if (client === ws) return;
        // forward with minimal wrapping
        send(client, data);
      });
    }
  });

  ws.on('close', () => {
    if (ws._room) {
      const s = rooms.get(ws._room);
      if (s) {
        s.delete(ws);
        if (s.size === 0) rooms.delete(ws._room);
        else s.forEach(c => send(c, { cmd: 'joined', room: ws._room, clients: s.size }));
      }
    }
  });
});

const PORT = process.env.PORT || 8080;
server.listen(PORT, () => console.log('Signaling server listening on', PORT));
```

### Açıklama
- Clientlar `{ cmd: 'join', room: '<roomId>' }` göndererek odaya katılır.
- Server, aynı odadaki diğer clientlara gönderilen tüm paketleri basitçe iletir (`offer`, `answer`, `candidate`).
- Basit, güvenlik/mevzuat kontrolleri yok — üretimde TLS (wss://) kullan ve authentication ekle.

---

## README.md (Kısa kullanım & deploy)

```
# SMessage — Signaling ile WebRTC P2P Sohbet

## Gereksinimler
- Node.js v18+ (sunucu için)
- Statik olarak yayınlanacak `index.html` (GitHub Pages, Netlify, Vercel vb.)

## Sunucu çalıştırma (lokal test)
1. `npm init -y`
2. `npm i ws`
3. `node server.js`
4. Sunucu varsayılan 8080 portunda çalışır. (DEMO için http://localhost:8080)

## Frontend deploy
- `index.html` dosyasını GitHub Pages veya herhangi bir statik host'a koy.
- `index.html` içinde `SIGNALING_SERVER_URL` değişkenini ayarlayın, örn: `const SIGNALING_SERVER_URL = 'ws://your.server:8080';`
- Sonra URL'e `?room=<odanoid>` paramı ekleyerek oda oluşturup paylaşın.

## Test Modu
- Sunucu olmadan da `Test Modu` butonuyla Local loopback testi yapabilirsiniz.

## Güvenlik notları
- Üretim için TLS (wss://) zorunlu. Ayrıca origin kontrolü, authentication ve rate limit ekleyin.
```

---

### Son not
- Ben frontend kodunu canvas içinde bıraktım; `index.html`'in tamamını oradan al ve repo'ya ekle. `server.js` ve `README.md`'yi yeni dosyalar olarak ekle.
- Deploy yaptıktan sonra `SIGNALING_SERVER_URL`'i güncelle, sayfayı yayınla, `?room=<id>` ile test et.

İstersen şimdi `server.js`'i Socket.IO versiyonuna çeviririm; ya da doğrudan bu `ws` tabanlı minimal sunucuyla devam et. Hangisini istiyorsun? (kısa cevap ver)

